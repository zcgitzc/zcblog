<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="关于程序与设计以及架构 | 曹杰乐，Java & Mobile Lover，Software Engineer | 这里是 @caojiele 曹杰乐 的个人博客，与你一起发现更大的世界。">
    <meta name="keywords"  content="曹杰乐, Jiele曹杰乐, Jiele, Jack-cao, @caojiele, 曹杰乐的博客, Jlcao Blog, 博客, 个人网站, 互联网, Java, node.js, 后端, 开发">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="小马哥Java面试题课程总结 - 曹杰乐的博客 | Jlcao Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="
  本文来自于我的慕课网手记：小马哥Java面试题课程总结，转载请保留链接 ;)

">
    
    <meta property="article:published_time" content="2019-04-14T00:00:00Z">
    
    
    <meta property="article:author" content="caojiele">
    
    
    <meta property="article:tag" content="Java">
    
    <meta property="article:tag" content="面试">
    
    <meta property="article:tag" content="慕课网手记">
    
    
    <meta property="og:image" content="http://localhost:4000https://cdn.nlark.com/yuque/0/2019/jpeg/338441/1561301140772-a4c43da7-3921-48bf-8c92-f57c4fdc97d9.jpeg">
    <meta property="og:url" content="http://localhost:4000/2019/04/14/java-interview-mercyblitz/">
    <meta property="og:site_name" content="曹杰乐的博客 | Jlcao Blog">
    
    <title>小马哥Java面试题课程总结 - 曹杰乐的博客 | Jlcao Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/zcblog/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/zcblog/img/root/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/zcblog/2019/04/14/java-interview-mercyblitz/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/zcblog/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/zcblog/css/hux-blog.min.css">
    
    <!-- Return to the top CSS -->
    <link rel="stylesheet" href="/css/rocket.css">
    <link rel="stylesheet" href="/css/signature.css">
    <link rel="stylesheet" href="/css/toc.css">
    
    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            
            <a href="javascript:history.back()" style="font-size:28px" class="fa fa-angle-left navbar-brand"></a>
            
            
            <a class="navbar-brand" href="/zcblog/">Jlcao Blog</a>
            
             <a href="javascript:void(0)" class="fa fa-search navbar-brand search-icon" id="search-ic"></a>
            
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/zcblog/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/zcblog/about/">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/zcblog/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li>
                        <a href="/zcblog/cooperation/">Cooperation</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>    
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
    
<!-- Search Box -->
<div class="search-box hidden">
  <div class="wrapper">
    <div class="search-grid">
      <form class="search-form">
        <div id="search-container">
          <input type="text" autocomplete="off" id="search-input" class="search" placeholder="Search..." maxlength="20" onkeypress="return onKeyPress(event)">
        </div>
      </form>
      <ul id="results-container" class="results-search">
      </ul>
      <div class="icon-close-container">
        <span class="search-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>
      </div>
    </div>
  </div>
</div>
    
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/zcblog/img/in-post/2019.04/14/post-java-interview.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/zcblog/img/in-post/2019.04/14/post-java-interview.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/zcblog/archive/?tag=Java" title="Java">Java</a>
                        
                        <a class="tag" href="/zcblog/archive/?tag=%E9%9D%A2%E8%AF%95" title="面试">面试</a>
                        
                        <a class="tag" href="/zcblog/archive/?tag=%E6%85%95%E8%AF%BE%E7%BD%91%E6%89%8B%E8%AE%B0" title="慕课网手记">慕课网手记</a>
                        
                    </div>
                    <h1>小马哥Java面试题课程总结</h1>
                    
                    <h2 class="subheading">面试虐我千百遍，Java 并发真讨厌</h2>
                    <span class="meta">Posted by caojiele on April 14, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- 添加评论系统 -->
<link rel="stylesheet" href="../../../../css/gitalk.css">
<script src="../../../../js/gitalk.min.js"></script>

<!-- 添加打赏 -->
<link href="/css/reward.css?v=6.2.0" rel="stylesheet" type="text/css" />

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<blockquote>
  <p>本文来自于我的<a href="https://www.imooc.com/u/4024769">慕课网手记</a>：<a href="https://www.imooc.com/article/288342">小马哥Java面试题课程总结</a>，转载请保留链接 ;)</p>
</blockquote>

<p>前段时间在慕课网直播上听<a href="https://www.imooc.com/t/5387391">小马哥</a>面试劝退（”面试虐我千百遍，Java 并发真讨厌”），发现讲得东西比自己拿到offer还要高兴，于是自己在线下做了一点小笔记，供各位参考。</p>

<p>课程地址：<a href="https://www.bilibili.com/video/av49124110">https://www.bilibili.com/video/av49124110</a></p>

<p>源码文档地址：<a href="https://github.com/mercyblitz/tech-weekly/tree/master/2019.04.12%20%E3%80%8C%E5%B0%8F%E9%A9%AC%E5%93%A5%E6%8A%80%E6%9C%AF%E5%91%A8%E6%8A%A5%E3%80%8D-%20%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E6%9C%9F%E3%80%8A%E9%9D%A2%E8%AF%95%E8%99%90%E6%88%91%E5%8D%83%E7%99%BE%E9%81%8D%EF%BC%8CJava%20%E5%B9%B6%E5%8F%91%E7%9C%9F%E8%AE%A8%E5%8E%8C%EF%BC%88%E7%BB%AD%EF%BC%89%E3%80%8B">https://github.com/mercyblitz/tech-weekly</a></p>

<h2 id="java-多线程">Java 多线程</h2>

<h3 id="1线程创建">1、线程创建</h3>

<h4 id="基本版">基本版</h4>
<p>有哪些方法创建线程？</p>

<p>仅仅只有<strong>new thread</strong>这种方法创建线程</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadCreationQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// main 线程 -&gt; 子线程</span>
        <span class="nc">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="o">},</span> <span class="s">"子线程-1"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="cm">/**
     * 不鼓励自定义（扩展） Thread
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>

        <span class="cm">/**
         * 多态的方式，覆盖父类实现
         */</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>与运行线程方法区分：
<strong>java.lang.Runnable()</strong> 或 <strong>java.lang.Thread类</strong></p>

<h4 id="进阶版">进阶版</h4>
<p>如何通过Java 创建进程？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcessCreationQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="c1">// 获取 Java Runtime</span>
        <span class="nc">Runtime</span> <span class="n">runtime</span> <span class="o">=</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">();</span>
        <span class="nc">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">exec</span><span class="o">(</span><span class="s">"cmd /k start http://www.baidu.com"</span><span class="o">);</span>
        <span class="n">process</span><span class="o">.</span><span class="na">exitValue</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版">劝退版</h4>
<p>如何销毁一个线程？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadStateQuestion</span> <span class="o">{</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// main 线程 -&gt; 子线程</span>
        <span class="nc">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// new Runnable(){ public void run(){...}};</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
        <span class="o">},</span> <span class="s">"子线程-1"</span><span class="o">);</span>

        <span class="c1">// 启动线程</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="c1">// 先于 Runnable 执行</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 是否还活着: %s\n"</span><span class="o">,</span> <span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">());</span> <span class="c1">// 1</span>
        <span class="c1">// 在 Java 中，执行线程 Java 是没有办法销毁它的，</span>
        <span class="c1">// 但是当 Thread.isAlive() 返回 false 时，实际底层的 Thread 已经被销毁了</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Java代码中是无法实现的，只能表现一个线程的状态。</p>

<p>而CPP是可以实现的。</p>

<h3 id="2线程执行">2、线程执行</h3>

<h4 id="基本版-1">基本版</h4>
<p>如何通过 Java API 启动线程？</p>

<p><strong>thread.start();</strong></p>

<h4 id="进阶版-1">进阶版</h4>
<p>当有线程 T1、T2 以及 T3，如何实现T1 -&gt; T2 -&gt; T3的执行顺序？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">threadJoinOneByOne</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t2"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t3"</span><span class="o">);</span>

        <span class="c1">// start() 仅是通知线程启动</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">// join() 控制线程必须执行完成</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>CountDownLatch</strong>也可以实现；</p>

<p><strong>调整优先级</strong>并不能保证优先级高的线程先执行。</p>

<h4 id="劝退版-1">劝退版</h4>
<p>以上问题请至少提供另外一种实现？（1.5）</p>

<p>1、spin 方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">threadLoop</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t2"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t3"</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t1</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// 自旋 Spin</span>
        <span class="o">}</span>

        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t2</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>

        <span class="o">}</span>

        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t3</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2、sleep 方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre> <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">threadSleep</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t2"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t3"</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t1</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// sleep</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t2</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">t3</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3、while 方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">threadWait</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t2"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ThreadExecutionQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t3"</span><span class="o">);</span>

        <span class="n">threadStartAndWait</span><span class="o">(</span><span class="n">t1</span><span class="o">);</span>
        <span class="n">threadStartAndWait</span><span class="o">(</span><span class="n">t2</span><span class="o">);</span>
        <span class="n">threadStartAndWait</span><span class="o">(</span><span class="n">t3</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">threadStartAndWait</span><span class="o">(</span><span class="nc">Thread</span> <span class="n">thread</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">thread</span><span class="o">.</span><span class="na">getState</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">thread</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">thread</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span> <span class="c1">// 到底是谁通知 Thread -&gt; thread.notify();  JVM帮它唤起</span>
                                  <span class="c1">// LockSupport.park(); </span>
                                 <span class="c1">// 死锁发生</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="3线程终止">3、线程终止</h3>

<h4 id="基本版-2">基本版</h4>
<p>如何停止一个线程？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HowToStopThreadQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="nc">Action</span> <span class="n">action</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Action</span><span class="o">();</span>

        <span class="c1">// 方法一</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="c1">// 改变 action stopped 状态</span>
        <span class="n">action</span><span class="o">.</span><span class="na">setStopped</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

        <span class="c1">// 方法二</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">isInterrupted</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">action</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">"t2"</span><span class="o">);</span>

        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">// 中断操作(仅仅设置状态，而并非中止线程）</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Action</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

        <span class="c1">// 线程安全问题，确保可见性（Happens-Before)</span>
        <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">stopped</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">stopped</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 执行动作</span>
                <span class="n">action</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStopped</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">stopped</span><span class="o">)</span> <span class="o">{</span>

            <span class="k">this</span><span class="o">.</span><span class="na">stopped</span> <span class="o">=</span> <span class="n">stopped</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>想要停止一个线程是不可能的，真正的只能停止逻辑。</p>

<h4 id="进阶版-2">进阶版</h4>
<p>为什么 Java 要放弃 Thread 的 stop()方法？</p>

<p><strong>Because it is inherently unsafe. Stopping a thread causes it to unlock all the monitors that it has locked.</strong>(The monitors are unlocked as the ThreadDeath exception propagates up the stack.) If any of the objects previously protected by these monitors were in an inconsistent state, other threads may now view these objects in an inconsistent state. Such objects are said to be damaged. When threads operate on damaged objects, arbitrary behavior can result. This behavior may be subtle and difficult to detect, or it may be pronounced. Unlike other unchecked exceptions, ThreadDeath kills threads silently; thus, the user has no warning that his program may be corrupted. The corruption can manifest itself at any time after the actual damage occurs, even hours or days in the future.</p>

<p>该方法具有固有的不安全性。用 Thread.stop 来终止线程将释放它已经锁定的所有监视器（作为沿堆栈向上传播的未检查 ThreadDeath 异常的一个自然后果）。如果以前受这些监视器保护的任何对象都处于一种不一致的状态，则损坏的对象将对其他线程可见，这有可能导致任意的行为。stop 的许多使用都应由只修改某些变量以指示目标线程应该停止运行的代码来取代。目标线程应定期检查该变量，并且如果该变量指示它要停止运行，则从其运行方法依次返回。如果目标线程等待很长时间（例如基于一个条件变量），则应使用 interrupt 方法来中断该等待。</p>

<p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html">Why is Thread.stop deprecated?</a></p>

<p><strong>简单的说，防止死锁，以及状态不一致的情况出现。</strong></p>

<h4 id="劝退版-2">劝退版</h4>
<p>请说明 Thread interrupt()、isInterrupted() 以及 interrupted()的区别以及意义？</p>

<p><strong>Thread interrupt()：</strong> 设置状态，调JVM的本地（native）<code class="highlighter-rouge">interrupt0</code>()方法。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">interrupt</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">!=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">())</span>
            <span class="n">checkAccess</span><span class="o">();</span>

        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">blockerLock</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Interruptible</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blocker</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">interrupt0</span><span class="o">();</span>  <span class="c1">// Just to set the interrupt flag</span>
                              <span class="c1">//--&gt; private native void interrupt0();</span>
                <span class="n">b</span><span class="o">.</span><span class="na">interrupt</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">interrupt0</span><span class="o">();</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>isInterrupted()：</strong> 调的是静态方法<code class="highlighter-rouge">isInterrupted()</code>,当且仅当状态设置为中断时，返回<code class="highlighter-rouge">false</code>，并不清除状态。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">interrupted</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">currentThread</span><span class="o">().</span><span class="na">isInterrupted</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Tests whether this thread has been interrupted.  The &lt;i&gt;interrupted
     * status&lt;/i&gt; of the thread is unaffected by this method.
     *
     * &lt;p&gt;A thread interruption ignored because a thread was not alive
     * at the time of the interrupt will be reflected by this method
     * returning false.
     *
     * @return  &lt;code&gt;true&lt;/code&gt; if this thread has been interrupted;
     *          &lt;code&gt;false&lt;/code&gt; otherwise.
     * @see     #interrupted()
     * @revised 6.0
     */</span>
     
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isInterrupted</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">isInterrupted</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>interrupted()：</strong> 私有本地方法，即判断中断状态，又清除状态。</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="kd">private</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isInterrupted</span><span class="o">(</span><span class="kt">boolean</span> <span class="nc">ClearInterrupted</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4线程异常">4、线程异常</h3>

<h4 id="基本版-3">基本版</h4>
<p>当线程遇到异常时，到底发生了什么？</p>

<p>线程会挂</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadExceptionQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="c1">//...</span>
        <span class="c1">// main 线程 -&gt; 子线程</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"数据达到阈值"</span><span class="o">);</span>
        <span class="o">},</span> <span class="s">"t1"</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">// main 线程会中止吗？</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

        <span class="c1">// Java Thread 是一个包装，它由 GC 做垃圾回收</span>
        <span class="c1">// JVM Thread 可能是一个 OS Thread，JVM 管理，</span>
        <span class="c1">// 当线程执行完毕（正常或者异常）</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t1</span><span class="o">.</span><span class="na">isAlive</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="进阶版-3">进阶版</h4>
<p>当线程遇到异常时，如何捕获？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="o">...</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">setDefaultUncaughtExceptionHandler</span><span class="o">((</span><span class="n">thread</span><span class="o">,</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 遇到了异常，详细信息：%s\n"</span><span class="o">,</span>
                    <span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
                    <span class="n">throwable</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">});</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版-3">劝退版</h4>
<p>当线程遇到异常时，ThreadPoolExecutor 如何捕获异常？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPoolExecutorExceptionQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

<span class="c1">//        ExecutorService executorService = Executors.newFixedThreadPool(2);</span>

        <span class="nc">ThreadPoolExecutor</span> <span class="n">executorService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadPoolExecutor</span><span class="o">(</span>
                <span class="mi">1</span><span class="o">,</span>
                <span class="mi">1</span><span class="o">,</span>
                <span class="mi">0</span><span class="o">,</span>
                <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
                <span class="k">new</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;&gt;()</span>
        <span class="o">)</span> <span class="o">{</span>

            <span class="cm">/**
             * 通过覆盖 {@link ThreadPoolExecutor#afterExecute(Runnable, Throwable)} 达到获取异常的信息
             * @param r
             * @param t
             */</span>
            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">afterExecute</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 遇到了异常，详细信息：%s\n"</span><span class="o">,</span>
                        <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
                        <span class="n">t</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>

        <span class="o">};</span>

        <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"数据达到阈值"</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="c1">// 等待一秒钟，确保提交的任务完成</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>

        <span class="c1">// 关闭线程池</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5线程状态">5、线程状态</h3>

<h4 id="基本版-4">基本版</h4>
<p>Java 线程有哪些状态，分别代表什么含义？</p>

<p><strong>NEW</strong>: Thread state for a thread which has not yet started.</p>

<p>未启动的。不会出现在Dump中。</p>

<p><strong>RUNNABLE</strong>: Thread state for a runnable thread. A thread in the runnable state is executing in the Java virtual machine, but it may be waiting for other resources from the operating system such as processor.</p>

<p>在虚拟机内执行的。运行中状态，可能里面还能看到locked字样，表明它获得了某把锁。</p>

<p><strong>BLOCKE</strong>: Thread state for a thread blocked waiting for a monitor lock. A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling {@link Object#wait() Object.wait}.</p>

<p>受阻塞并等待监视器锁。被某个锁(synchronizers)給block住了。</p>

<p><strong>WAITING</strong>: Thread state for a waiting thread. A thread is in the waiting state due to calling one of the following methods:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>{@link Object#wait() Object.wait} with no timeout<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>{@link #join() Thread.join} with no timeout<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>{@link LockSupport#park() LockSupport.park}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>A thread in the waiting state is waiting for another thread to perform a particular action.</p>

<p>For example, a thread that has called Object.wait() on an object is waiting for another thread to call Object.notify() or Object.notifyAll() on that object. A thread that has called Thread.join() is waiting for a specified thread to terminate.</p>

<p>无限期等待另一个线程执行特定操作。等待某个condition或monitor发生，一般停留在park(), wait(), sleep(),join() 等语句里。</p>

<p><strong>TIMED_WAITING</strong>: Thread state for a waiting thread with a specified waiting time. A thread is in the timed waiting state due to calling one of the following methods with a specified positive waiting time:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ul&gt;</span>
     <span class="nt">&lt;li&gt;</span>{@link #sleep Thread.sleep}<span class="nt">&lt;/li&gt;</span>
     <span class="nt">&lt;li&gt;</span>{@link Object#wait(long) Object.wait} with timeout<span class="nt">&lt;/li&gt;</span>
     <span class="nt">&lt;li&gt;</span>{@link #join(long) Thread.join} with timeout<span class="nt">&lt;/li&gt;</span>
     <span class="nt">&lt;li&gt;</span>{@link LockSupport#parkNanos LockSupport.parkNanos}<span class="nt">&lt;/li&gt;</span>
     <span class="nt">&lt;li&gt;</span>{@link LockSupport#parkUntil LockSupport.parkUntil}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>有时限的等待另一个线程的特定操作。和WAITING的区别是wait() 等语句加上了时间限制 wait(timeout)。</p>

<p><strong>TERMINATED</strong>: 已退出的; Thread state for a terminated thread. The thread has completed execution.</p>

<h4 id="进阶版-4">进阶版</h4>
<p>如何获取当前JVM 所有的现场状态？</p>

<p>方法一：命令</p>

<p><code class="highlighter-rouge">jstack</code>: jstack用于打印出给定的java进程ID或core file或远程调试服务的Java堆栈信息。主要用来查看Java线程的调用堆栈的，可以用来分析线程问题（如死锁）。</p>

<p><code class="highlighter-rouge">jsp</code></p>

<p><code class="highlighter-rouge">jsp [option/ -l] pid</code></p>

<p>方法二：ThreadMXBean</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AllThreadStackQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ThreadMXBean</span> <span class="n">threadMXBean</span> <span class="o">=</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="na">getThreadMXBean</span><span class="o">();</span>
        <span class="kt">long</span><span class="o">[]</span> <span class="n">threadIds</span> <span class="o">=</span> <span class="n">threadMXBean</span><span class="o">.</span><span class="na">getAllThreadIds</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">threadId</span> <span class="o">:</span> <span class="n">threadIds</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ThreadInfo</span> <span class="n">threadInfo</span> <span class="o">=</span> <span class="n">threadMXBean</span><span class="o">.</span><span class="na">getThreadInfo</span><span class="o">(</span><span class="n">threadId</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">threadInfo</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版-4">劝退版</h4>
<p>如何获取线程的资源消费情况？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AllThreadInfoQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ThreadMXBean</span> <span class="n">threadMXBean</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ThreadMXBean</span><span class="o">)</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="na">getThreadMXBean</span><span class="o">();</span>
        <span class="kt">long</span><span class="o">[]</span> <span class="n">threadIds</span> <span class="o">=</span> <span class="n">threadMXBean</span><span class="o">.</span><span class="na">getAllThreadIds</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">threadId</span> <span class="o">:</span> <span class="n">threadIds</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//            ThreadInfo threadInfo = threadMXBean.getThreadInfo(threadId);</span>
<span class="c1">//            System.out.println(threadInfo.toString());</span>
            <span class="kt">long</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">threadMXBean</span><span class="o">.</span><span class="na">getThreadAllocatedBytes</span><span class="o">(</span><span class="n">threadId</span><span class="o">);</span>
            <span class="kt">long</span> <span class="n">kBytes</span> <span class="o">=</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[ID:%d] 分配内存： %s KB\n"</span><span class="o">,</span> <span class="n">threadId</span><span class="o">,</span> <span class="n">kBytes</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6线程同步">6、线程同步</h3>

<h4 id="基本版-5">基本版</h4>
<p>请说明 synchronized 关键字在修饰方法与代码块中的区别？</p>

<p>字节码的区别 (一个monitor,一个synchronized关键字)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronizedKeywordQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">synchronizedBlock</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">SynchronizedKeywordQuestion</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">synchronizedMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="进阶版-5">进阶版</h4>
<p>请说明 synchronized 关键字与 ReentrantLock 之间的区别？</p>

<ul>
  <li>两者都是可重入锁</li>
  <li>synchronized 依赖于 JVM 而 ReentrantLock 依赖于 API</li>
  <li>ReentrantLock 比 synchronized 增加了一些高级功能</li>
</ul>

<p>相比synchronized，ReentrantLock增加了一些高级功能。主要来说主要有三点：①等待可中断；②可实现公平锁；③可实现选择性通知（锁可以绑定多个条件）</p>
<ul>
  <li>两者的性能已经相差无几</li>
</ul>

<p><a href="https://snailclimb.top/JavaGuide/#/./essential-content-for-interview/PreparingForInterview/美团面试常见问题总结?id=_3-谈谈-synchronized-和-reentrantlock-的区别">谈谈 synchronized 和 ReentrantLock 的区别</a></p>

<h4 id="劝退版-5">劝退版</h4>
<p>请解释偏向锁对 synchronized 与 ReentrantLock 的价值？</p>

<p>偏向锁只对 synchronized 有用，而 ReentrantLock 已经实现了偏向锁。</p>

<p><a href="https://wiki.openjdk.java.net/display/HotSpot/Synchronization">Synchronization and Object Locking</a></p>

<h3 id="7线程通讯">7、线程通讯</h3>

<h4 id="基本版-6">基本版</h4>
<p>为什么 wait() 和 notify() 以及 notifyAll() 方法属于 Object ,并解释它们的作用？</p>

<p>Java所有对象都是来自 Object</p>

<p><strong>wait():</strong></p>

<p><strong>notify():</strong></p>

<p><strong>notifyAll():</strong></p>

<h4 id="进阶版-6">进阶版</h4>
<p>为什么 Object wait() notify() 以及 notifyAll() 方法必须 synchronized 之中执行？</p>

<p><strong>wait():</strong> 获得锁的对象，释放锁，当前线程又被阻塞，等同于Java 5 LockSupport 中的park方法</p>

<p><strong>notify():</strong> 已经获得锁，唤起一个被阻塞的线程，等同于Java 5 LockSupport 中的unpark()方法</p>

<p><strong>notifyAll():</strong></p>

<h4 id="劝退版-6">劝退版</h4>
<p>请通过 Java 代码模拟实现 wait() 和 notify() 以及 notifyAll() 的语义？</p>

<h3 id="8线程退出">8、线程退出</h3>

<h4 id="基本版-7">基本版</h4>
<p>当主线程退出时，守护线程会执行完毕吗？</p>

<p>不一定执行完毕</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DaemonThreadQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// main 线程</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello,World"</span><span class="o">);</span>
<span class="c1">//            Thread currentThread = Thread.currentThread();</span>
<span class="c1">//            System.out.printf("线程[name : %s, daemon:%s]: Hello,World\n",</span>
<span class="c1">//                    currentThread.getName(),</span>
<span class="c1">//                    currentThread.isDaemon()</span>
<span class="c1">//            );</span>
        <span class="o">},</span> <span class="s">"daemon"</span><span class="o">);</span>
        <span class="c1">// 编程守候线程</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">setDaemon</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="c1">// 守候线程的执行依赖于执行时间（非唯一评判）</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="进阶版-7">进阶版</h4>
<p>请说明 ShutdownHook 线程的使用场景，以及如何触发执行？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShutdownHookQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">Runtime</span> <span class="n">runtime</span> <span class="o">=</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">();</span>

        <span class="n">runtime</span><span class="o">.</span><span class="na">addShutdownHook</span><span class="o">(</span><span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">ShutdownHookQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"Shutdown Hook Question"</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>使用场景：Spring 中 AbstractApplicationContext 的 registerShutdownHook()</p>

<h4 id="劝退版-7">劝退版</h4>
<p>如何确保主线程退出前，所有线程执行完毕？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompleteAllThreadsQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="c1">// main 线程 -&gt; 子线程</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">CompleteAllThreadsQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t1"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">CompleteAllThreadsQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t2"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">CompleteAllThreadsQuestion:</span><span class="o">:</span><span class="n">action</span><span class="o">,</span> <span class="s">"t3"</span><span class="o">);</span>

        <span class="c1">// 不确定 t1、t2、t3 是否调用 start()</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="c1">// 创建了 N Thread</span>

        <span class="nc">Thread</span> <span class="n">mainThread</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
        <span class="c1">// 获取 main 线程组</span>
        <span class="nc">ThreadGroup</span> <span class="n">threadGroup</span> <span class="o">=</span> <span class="n">mainThread</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">();</span>
        <span class="c1">// 活跃的线程数</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">threadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">();</span>
        <span class="nc">Thread</span><span class="o">[]</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">[</span><span class="n">count</span><span class="o">];</span>
        <span class="c1">// 把所有的线程复制 threads 数组</span>
        <span class="n">threadGroup</span><span class="o">.</span><span class="na">enumerate</span><span class="o">(</span><span class="n">threads</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">Thread</span> <span class="n">thread</span> <span class="o">:</span> <span class="n">threads</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"当前活跃线程: %s\n"</span><span class="o">,</span> <span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="java-并发集合框架">Java 并发集合框架</h2>

<h3 id="1线程安全集合">1、线程安全集合</h3>

<h4 id="基本版-8">基本版</h4>
<p>请在 Java 集合框架以及 J.U.C 框架中各列举出 List、Set 以及 Map 的实现？</p>

<p>Java 集合框架: LinkedList、ArrayList、HashSet、TreeSet、HashMap</p>

<p>J.U.C 框架: CopyOnWriteArrayList、CopyOnWriteArraySet、ConcurrentSkipListSet、ConcurrentSkipListMap、ConcurrentHashMap</p>

<h4 id="进阶版-8">进阶版</h4>
<p>如何将普通 List、Set 以及 Map 转化为线程安全对象？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadSafeCollectionQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="nc">Set</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"A"</span><span class="o">);</span>

        <span class="c1">// 以上实现都是不变对象，不过第一个除外</span>

        <span class="c1">// 通过 Collections#sychronized* 方法返回</span>

        <span class="c1">// Wrapper 设计模式（所有的方法都被 synchronized 同步或互斥）</span>
        <span class="n">list</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>

        <span class="n">set</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedSet</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>

        <span class="n">map</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedMap</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版-8">劝退版</h4>
<p>如何在 Java 9+ 实现以上问题？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadSafeCollectionQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Java 9 的实现</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

        <span class="c1">// Java 9 + of 工厂方法，返回 Immutable 对象</span>

        <span class="n">list</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="nc">Set</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"A"</span><span class="o">);</span>

        <span class="c1">// 以上实现都是不变对象，不过第一个除外</span>

        <span class="c1">// 通过 Collections#sychronized* 方法返回</span>

        <span class="c1">// Wrapper 设计模式（所有的方法都被 synchronized 同步或互斥）</span>
        <span class="n">list</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>

        <span class="n">set</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedSet</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>

        <span class="n">map</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedMap</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

        <span class="c1">//</span>
        <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CopyOnWriteArrayList</span><span class="o">&lt;&gt;(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CopyOnWriteArraySet</span><span class="o">&lt;&gt;(</span><span class="n">set</span><span class="o">);</span>
        <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;&gt;(</span><span class="n">map</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2线程安全-list">2、线程安全 LIST</h3>

<h4 id="基本版-9">基本版</h4>
<p>请说明 List、Vector 以及 CopyOnWriteArrayList 的相同点和不同点？</p>

<p><strong>相同点：</strong></p>

<p>Vector、CopyOnWriteArrayList 是 List 的实现。</p>

<p><strong>不同点：</strong></p>

<p>Vector 是同步的,任何时候不加锁。并且在设计中有个 interator ,返回的对象是 <code class="highlighter-rouge">fail-fast</code>；</p>

<p>CopyOnWriteArrayList 读的时候是不加锁；弱一致性，while true的时候不报错。</p>

<h4 id="进阶版-9">进阶版</h4>
<p>请说明 Collections#synchromizedList(List) 与 Vector 的相同点和不同点？</p>

<p><strong>相同点：</strong></p>

<p>都是<code class="highlighter-rouge">synchromized</code> 的实现方式。</p>

<p><strong>不同点：</strong></p>

<p>synchromized 返回的是list, 实现原理方式是 Wrapper 实现；</p>

<p>而 Vector 是 List 的实现。实现原理方式是非 Wrapper 实现。</p>

<h4 id="劝退版-9">劝退版</h4>
<p>Arrays#asList(Object…)方法是线程安全的吗？如果不是的话，如果实现替代方案？</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArraysAsListMethodQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="c1">// 调整第三个元素为 9</span>
        <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">);</span>
        <span class="c1">// 3 -&gt; 9</span>
        <span class="c1">// Arrays.asList 并非线程安全</span>
        <span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="c1">// Java &lt; 5 , Collections#synchronizedList</span>
        <span class="c1">// Java 5+ , CopyOnWriteArrayList</span>
        <span class="c1">// Java 9+ , List.of(...) 只读</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3线程安全-set">3、线程安全 SET</h3>

<h4 id="基本版-10">基本版</h4>
<p>请至少举出三种线程安全的 Set 实现？</p>

<p>synchronizedSet、CopyOnWriteArraySet、ConcurrentSkipListSet</p>

<h4 id="进阶版-10">进阶版</h4>
<p>在 J.U.C 框架中，存在HashSet 的线程安全实现？如果不存在的话，要如何实现？</p>

<p>不存在；</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcurrentHashSetQuestion</span> <span class="o">{</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ConcurrentHashSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="no">OBJECT</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;</span><span class="no">E</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

        <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="nf">keySet</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">keySet</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">keySet</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">keySet</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Object</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="no">OBJECT</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">retainAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版-10">劝退版</h4>
<p>当 Set#iterator() 方法返回 Iterator 对象后，能否在其迭代中，给 Set 对象添加新的元素？</p>

<p>不一定；Set 在传统实现中，会有<code class="highlighter-rouge">fail-fast</code>问题；而在J.U.C中会出现弱一致性，对数据的一致性要求较低，是可以给 Set 对象添加新的元素。</p>

<h3 id="4线程安全-map">4、线程安全 MAP</h3>

<h4 id="基本版-11">基本版</h4>
<p>请说明 Hashtable、HashMap 以及 ConcurrentHashMap 的区别？</p>

<p><strong>Hashtable：</strong> key、value值都不能为空; 数组结构上，通过数组和链表实现。</p>

<p><strong>HashMap：</strong> key、value值都能为空；数组结构上，当阈值到达8时，通过红黑树实现。</p>

<p><strong>ConcurrentHashMap：</strong> key、value值都不能为空；数组结构上，当阈值到达8时，通过红黑树实现。</p>

<p><a href="https://zhuanlan.zhihu.com/p/37607299">HashMap和Hashtable的比较</a></p>

<h4 id="进阶版-11">进阶版</h4>
<p>请说明 ConcurrentHashMap 在不同的JDK 中的实现？</p>

<p>JDK 1.6中，采用分离锁的方式，在读的时候，部分锁；写的时候，完全锁。而在JDK 1.7、1.8中，读的时候不需要锁的，写的时候需要锁的。并且JDK 1.8中在为了解决Hash冲突，采用红黑树解决。</p>

<p><a href="https://zhuanlan.zhihu.com/p/50675786">HashMap? ConcurrentHashMap? 相信看完这篇没人能难住你！</a></p>

<h4 id="劝退版-11">劝退版</h4>
<p>请说明 ConcurrentHashMap 与 ConcurrentSkipListMap 各自的优势与不足？</p>

<p>在 java 6 和 8 中，ConcurrentHashMap 写的时候，是加锁的，所以内存占得比较小，而 ConcurrentSkipListMap 写的时候是不加锁的，内存占得相对比较大，通过空间换取时间上的成本，速度较快，但比前者要慢，ConcurrentHashMap 基本上是常量时间。ConcurrentSkipListMap 读和写都是log N实现，高性能相对稳定。</p>

<h3 id="5线程安全-queue">5、线程安全 QUEUE</h3>

<h4 id="基本版-12">基本版</h4>
<p>请说明 BlockingQueue 与 Queue 的区别？</p>

<p>BlockingQueue 继承了 Queue 的实现；put 方法中有个阻塞的操作（InterruptedException），当队列满的时候，put 会被阻塞；当队列空的时候，put方法可用。take 方法中，当数据存在时，才可以返回，否则为空。</p>

<h4 id="进阶版-12">进阶版</h4>
<p>请说明 LinkedBlockingQueue 与 ArrayBlockingQueue 的区别？</p>

<p>LinkedBlockingQueue 是链表结构；有两个构造器，一个是（Integer.MAX_VALUE)，无边界，另一个是(int capacity)，有边界；ArrayBlockingQueue 是数组结构；有边界。</p>

<h4 id="劝退版-12">劝退版</h4>
<p>请说明 LinkedTransferQueue 与 LinkedBlockingQueue 的区别？</p>

<p>LinkedTransferQueue 是java 7中提供的新接口，性能比后者更优化。</p>

<h3 id="6priorityblockingqueue">6、PRIORITYBLOCKINGQUEUE</h3>

<h4 id="请评估以下程序的运行结果">请评估以下程序的运行结果？</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">priorityBlockingQueueQuiz</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="k">throw</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
        <span class="c1">// 1. PriorityBlockingQueue put(Object) 方法不阻塞，不抛异常</span>
        <span class="c1">// 2. PriorityBlockingQueue offer(Object) 方法不限制，允许长度变长</span>
        <span class="c1">// 3. PriorityBlockingQueue 插入对象会做排序，默认参照元素 Comparable 实现，</span>
        <span class="c1">//    或者显示地传递 Comparator</span>
        <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">9</span><span class="o">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.size() ="</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.take() ="</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue ="</span> <span class="o">+</span> <span class="n">queue</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>运行结果：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>queue.size() = 3
queue.take() = 1
queue = [8,9]
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="7synchronousqueue">7、SYNCHRONOUSQUEUE</h3>

<h4 id="请评估以下程序的运行结果-1">请评估以下程序的运行结果？</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronusQueueQuiz</span><span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SynchronousQueue</span><span class="o">&lt;&gt;();</span>
        <span class="c1">// 1. SynchronousQueue 是无空间，offer 永远返回 false</span>
        <span class="c1">// 2. SynchronousQueue take() 方法会被阻塞，必须被其他线程显示地调用 put(Object);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">pringln</span><span class="o">(</span><span class="s">"queue.offer(1) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">pringln</span><span class="o">(</span><span class="s">"queue.offer(2) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">pringln</span><span class="o">(</span><span class="s">"queue.offer(3) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.take() = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.size = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>运行结果：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>queue.offer(1) = false
queue.offer(2) = false
queue.offer(3) = false
</pre></td></tr></tbody></table></code></pre></div></div>
<p>SynchronousQueue take() 方法会被阻塞</p>

<h3 id="8blockingqueue-offer">8、BLOCKINGQUEUE OFFER()</h3>

<h4 id="请评估以下程序的运行结果-2">请评估以下程序的运行结果？</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockingQueueQuiz</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">offer</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">));</span>
        <span class="n">offer</span><span class="o">(</span><span class="k">new</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">));</span>
        <span class="n">offer</span><span class="o">(</span><span class="k">new</span> <span class="nc">PriorityBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">));</span>
        <span class="n">offer</span><span class="o">(</span><span class="k">new</span> <span class="nc">SynchronousQueue</span><span class="o">&lt;&gt;());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">offer</span><span class="o">(</span><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.getClass() = "</span> <span class="o">+</span><span class="n">queue</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.offer(1) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.offer(2) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.offer(3) = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.size() = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"queue.take() = "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>运行结果：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>queue.getClass() = java.util.concurrent.ArrayBlockingQueue
queue.offer(1) = true
queue.offer(2) = true
queue.offer(3) = false
queue.size() = 2
queue.take() = 1

queue.getClass() = java.util.concurrent.LinkedBlockingQueue
queue.offer(1) = true
queue.offer(2) = true
queue.offer(3) = false
queue.size() = 2
queue.take() = 1

queue.getClass() = java.util.concurrent.PriorityBlockingQueue
queue.offer(1) = true
queue.offer(2) = true
queue.offer(3) = false
queue.size() = 3
queue.take() = 1

queue.getClass() = java.util.concurrent.SynchronousQueue
queue.offer(1) = false
queue.offer(2) = false
queue.offer(3) = false
queue.size() = 0
</pre></td></tr></tbody></table></code></pre></div></div>
<p>queue.take() 方法会被阻塞</p>

<h2 id="java-并发框架">Java 并发框架</h2>

<h3 id="1锁-lock">1、锁 LOCK</h3>

<h4 id="基本版-13">基本版</h4>
<p>请说明 ReentranLock 与 ReentrantReadWriteLock 的区别？</p>

<p>jdk 1.5 以后，ReentranLock(重进入锁)与 ReentrantReadWriteLock 都是可重进入的锁，ReentranLock 都是互斥的，而 ReentrantReadWriteLock 是共享的，其中里面有两个类，一个是 ReadLock（共享，并行，强调数据一致性或者说可见性），另一个是 WriteLock(互斥，串行)。</p>

<h4 id="进阶版-13">进阶版</h4>
<p>请解释 ReentrantLock 为什么命名为重进入？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReentrantLockQuestion</span> <span class="o">{</span>

    <span class="cm">/**
     * T1 , T2 , T3
     *
     * T1(lock) , T2(park), T3(park)
     * Waited Queue -&gt; Head-&gt; T2 next -&gt; T3
     * T1(unlock) -&gt; unpark all
     * Waited Queue -&gt; Head-&gt; T2 next -&gt; T3
     * T2(free), T3(free)
     *
     * -&gt; T2(lock) , T3(park)
     * Waited Queue -&gt; Head-&gt; T3
     * T2(unlock) -&gt; unpark all
     * T3(free)
     */</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// thread[main] -&gt;</span>
        <span class="c1">// lock     lock           lock</span>
        <span class="c1">// main -&gt; action1() -&gt; action2() -&gt; action3()</span>
        <span class="n">synchronizedAction</span><span class="o">(</span><span class="nl">ReentrantLockQuestion:</span><span class="o">:</span><span class="n">action1</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">synchronizedAction</span><span class="o">(</span><span class="nl">ReentrantLockQuestion:</span><span class="o">:</span><span class="n">action2</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">synchronizedAction</span><span class="o">(</span><span class="nl">ReentrantLockQuestion:</span><span class="o">:</span><span class="n">action3</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action3</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello,World"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">synchronizedAction</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">runnable</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">runnable</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="劝退版-13">劝退版</h4>
<p>请说明 Lock#lock() 与 Lock#lockInterruptibly() 的区别？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>    <span class="cm">/**
     * java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued
     * 如果当前线程已被其他线程调用了 interrupt() 方法时，这时会返回 true
     * acquireQueued 执行完时，interrupt 清空（false）
     * 再通过 selfInterrupt() 方法将状态恢复（interrupt=true）
     */</span>
         <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">lockVsLockInterruptibly</span><span class="o">();</span>
     <span class="o">}</span>
     
        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">lockVsLockInterruptibly</span><span class="o">()</span> <span class="o">{</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lockInterruptibly</span><span class="o">();</span>
            <span class="n">action1</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 显示地恢复中断状态</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
            <span class="c1">// 当前线程并未消亡，线程池可能还在存活</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>lock()</strong>  优先考虑获取锁，待获取锁成功后，才响应中断。</p>

<p>**lockInterruptibly() ** 优先考虑响应中断，而不是响应锁的普通获取或重入获取。</p>

<p><strong>ReentrantLock.lockInterruptibly</strong> 允许在等待时由其它线程调用等待线程的 Thread.interrupt 方法来中断等待线程的等待而直接返回，这时不用获取锁，而会抛出一个 InterruptedException。</p>

<p><strong>ReentrantLock.lock</strong> 方法不允许 Thread.interrupt 中断,即使检测到 Thread.isInterrupted ,一样会继续尝试获取锁，失败则继续休眠。只是在最后获取锁成功后再把当前线程置为 interrupted 状态,然后再中断线程。</p>

<h3 id="2条件变量-condition">2、条件变量 CONDITION</h3>

<h4 id="基本版-14">基本版</h4>
<p>请举例说明 Condition 使用场景？</p>

<ol>
  <li>CoutDownLatch (condition 变种)</li>
  <li>CyclicBarrier (循环屏障)</li>
  <li>信号量/灯（Semaphore) java 9</li>
  <li>生产者和消费者</li>
  <li>阻塞队列</li>
</ol>

<h4 id="进阶版-14">进阶版</h4>
<p>请使用 Condition 实现 “生产者-消费者问题”？</p>

<p><a href="https://blog.csdn.net/u014082714/article/details/83927697">使用Condition实现生产者消费者</a></p>

<h4 id="劝退版-14">劝退版</h4>
<p>请解释 Condition await() 和 signal() 与 Object wait () 和 notify() 的相同与差异？</p>

<p>相同：阻塞和释放</p>

<p>差异：Java Thread 对象和实际 JVM 执行的 OS Thread 不是相同对象，JVM Thread 回调 Java Thread.run() 方法，同时 Thread 提供一些 native 方法来获取 JVM Thread 状态，当JVM thread 执行后，自动 notify()了。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>        <span class="k">while</span> <span class="o">(</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// Thread 特殊的 Object</span>
            <span class="c1">// 当线程 Thread isAlive() == false 时，thread.wait() 操作会被自动释放</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">thread</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">thread</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span> <span class="c1">// 到底是谁通知 Thread -&gt; thread.notify();</span>
<span class="c1">//                    LockSupport.park(); // 死锁发生</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3屏障-barriers">3、屏障 BARRIERS</h3>

<h4 id="基本版-15">基本版</h4>
<p>请说明 CountDownLatch 与 CyclicBarrier 的区别？</p>

<p><strong>CountDownLatch</strong> : 不可循环的，一次性操作（倒计时）。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountDownLatchQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="c1">// 倒数计数 5</span>
        <span class="nc">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">action</span><span class="o">();</span>
                <span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span> <span class="c1">// -1</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="c1">// 等待完成</span>
        <span class="c1">// 当计数 &gt; 0，会被阻塞</span>
        <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Done"</span><span class="o">);</span>

        <span class="c1">// 关闭线程池</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>CyclicBarrier</strong>：可循环的， 先计数 -1，再判断当计数 &gt; 0 时候，才阻塞。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CyclicBarrierQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="nc">CyclicBarrier</span> <span class="n">barrier</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CyclicBarrier</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// 5</span>

        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// 3</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">action</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="c1">// CyclicBarrier.await() = CountDownLatch.countDown() + await()</span>
                    <span class="c1">// 先计数 -1，再判断当计数 &gt; 0 时候，才阻塞</span>
                    <span class="n">barrier</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">BrokenBarrierException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="c1">// 尽可能不要执行完成再 reset</span>
        <span class="c1">// 先等待 3 ms</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
        <span class="c1">// 再执行 CyclicBarrier reset</span>
        <span class="c1">// reset 方法是一个废操作</span>
        <span class="n">barrier</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Done"</span><span class="o">);</span>

        <span class="c1">// 关闭线程池</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="进阶版-15">进阶版</h4>
<p>请说明 Semaphore（信号量/灯） 的使用场景？</p>

<p>Semaphore 和Lock类似，比Lock灵活。其中有 acquire() 和 release() 两种方法，arg 都等于 1。acquire() 会抛出 InterruptedException，同时从 <code class="highlighter-rouge">sync.acquireSharedInterruptibly(arg:1)</code>可以看出是读模式（shared)； release()中可以计数，可以控制数量，permits可以传递N个数量。</p>

<p><a href="https://blog.csdn.net/zbc1090549839/article/details/53389602">Java中Semaphore(信号量)的使用</a></p>

<h4 id="劝退版-15">劝退版</h4>
<p>请通过 Java 1.4 的语法实现一个 CountDownLatch?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LegacyCountDownLatchDemo</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="c1">// 倒数计数 5</span>
        <span class="nc">MyCountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyCountDownLatch</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">action</span><span class="o">();</span>
                <span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span> <span class="c1">// -1</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="c1">// 等待完成</span>
        <span class="c1">// 当计数 &gt; 0，会被阻塞</span>
        <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Done"</span><span class="o">);</span>

        <span class="c1">// 关闭线程池</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Java 1.5+ Lock 实现
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyCountDownLatch</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Condition</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>

        <span class="kd">private</span> <span class="nf">MyCountDownLatch</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">await</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
            <span class="c1">// 当 count &gt; 0 等待</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InterruptedException</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">condition</span><span class="o">.</span><span class="na">await</span><span class="o">();</span> <span class="c1">// 阻塞当前线程</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countDown</span><span class="o">()</span> <span class="o">{</span>

            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">count</span><span class="o">--;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 当数量减少至0时，唤起被阻塞的线程</span>
                    <span class="n">condition</span><span class="o">.</span><span class="na">signalAll</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Java &lt; 1.5 实现
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LegacyCountDownLatch</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

        <span class="kd">private</span> <span class="nf">LegacyCountDownLatch</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">await</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
            <span class="c1">// 当 count &gt; 0 等待</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InterruptedException</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">wait</span><span class="o">();</span> <span class="c1">// 阻塞当前线程</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countDown</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">count</span><span class="o">--;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 当数量减少至0时，唤起被阻塞的线程</span>
                    <span class="n">notifyAll</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4线程池-thread-pool">4、线程池 THREAD POOL</h3>

<h4 id="基本版-16">基本版</h4>
<p>请问 J.U.C 中内建了几种 ExceptionService 实现？</p>

<p>1.5：ThreadPoolExecutor、ScheduledThreadPoolExecutor</p>

<p>1.7：ForkJoinPool</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExecutorServiceQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="cm">/**
         * 1.5
         *  ThreadPoolExecutor
         *  ScheduledThreadPoolExecutor :: ThreadPoolExecutor
         * 1.7
         *  ForkJoinPool
         */</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

        <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

        <span class="c1">// executorService 不再被引用，它会被 GC -&gt; finalize() -&gt; shutdown()</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService2</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="进阶版-16">进阶版</h4>
<p>请分别解释 ThreadPoolExecutor 构造器参数在运行时的作用？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Creates a new {@code ThreadPoolExecutor} with the given initial
 * parameters.
 *
 * @param corePoolSize the number of threads to keep in the pool, even
 *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
 * @param maximumPoolSize the maximum number of threads to allow in the
 *        pool
 * @param keepAliveTime when the number of threads is greater than
 *        the core, this is the maximum time that excess idle threads
 *        will wait for new tasks before terminating.
 * @param unit the time unit for the {@code keepAliveTime} argument
 * @param workQueue the queue to use for holding tasks before they are
 *        executed.  This queue will hold only the {@code Runnable}
 *        tasks submitted by the {@code execute} method.
 * @param threadFactory the factory to use when the executor
 *        creates a new thread
 * @param handler the handler to use when execution is blocked
 *        because the thread bounds and queue capacities are reached
 * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
 *         {@code corePoolSize &lt; 0}&lt;br&gt;
 *         {@code keepAliveTime &lt; 0}&lt;br&gt;
 *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
 *         {@code maximumPoolSize &lt; corePoolSize}
 * @throws NullPointerException if {@code workQueue}
 *         or {@code threadFactory} or {@code handler} is null
 */</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
                          <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
                          <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
                          <span class="nc">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">,</span>
                          <span class="nc">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>corePoolSize</strong>: 核心线程池大小。这个参数是否生效取决于allowCoreThreadTimeOut变量的值，该变量默认是false，即对于核心线程没有超时限制，所以这种情况下，corePoolSize参数是起效的。如果allowCoreThreadTimeOut为true，那么核心线程允许超时，并且超时时间就是keepAliveTime参数和unit共同决定的值，这种情况下，如果线程池长时间空闲的话最终存活的线程会变为0，也即corePoolSize参数失效。</p>

<p><strong>maximumPoolSize</strong>: 线程池中最大的存活线程数。这个参数比较好理解，对于超出corePoolSize部分的线程，无论allowCoreThreadTimeOut变量的值是true还是false，都会超时，超时时间由keepAliveTime和unit两个参数算出。</p>

<p><strong>keepAliveTime</strong>: 超时时间。</p>

<p><strong>unit</strong>: 超时时间的单位，秒，毫秒，微秒，纳秒等，与keepAliveTime参数共同决定超时时间。</p>

<p><strong>workQueue</strong>: 线程等待队列。当调用execute方法时，如果线程池中没有空闲的可用线程，那么就会把这个Runnable对象放到该队列中。这个参数必须是一个实现BlockingQueue接口的阻塞队列，因为要保证线程安全。有一个要注意的点是，只有在调用execute方法是，才会向这个队列中添加任务，那么对于submit方法呢，难道submit方法提交任务时如果没有可用的线程就直接扔掉吗？当然不是，看一下AbstractExecutorService类中submit方法实现，其实submit方法只是把传进来的Runnable对象或Callable对象包装成一个新的Runnable对象，然后调用execute方法，并将包装后的FutureTask对象作为一个Future引用返回给调用者。Future的阻塞特性实际是在FutureTask中实现的，具体怎么实现感兴趣的话可以看一下FutureTask的源码。</p>

<p><strong>threadFactory</strong>: 线程创建工厂。用于在需要的时候生成新的线程。默认实现是Executors.defaultThreadFactory()，即new 一个Thread对象，并设置线程名称，daemon等属性。</p>

<p><strong>handler</strong>: 拒绝策略。这个参数的作用是当提交任务时既没有空闲线程，任务队列也满了，这时候就会调用handler的rejectedExecution方法。默认的实现是抛出一个RejectedExecutionException异常。</p>

<h4 id="劝退版-16">劝退版</h4>
<p>如何获取 ThreadPoolExecutor 正在运行的线程？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPoolExecutorThreadQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>

        <span class="c1">// main 线程启动子线程，子线程的创造来自于 Executors.defaultThreadFactory()</span>

        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
        <span class="c1">// 之前了解 ThreadPoolExecutor beforeExecute 和 afterExecute 能够获取当前线程数量</span>

        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threadsContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

        <span class="n">setThreadFactory</span><span class="o">(</span><span class="n">executorService</span><span class="o">,</span> <span class="n">threadsContainer</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> <span class="c1">// 开启 9 个线程</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="c1">// 线程池等待执行 3 ms</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

        <span class="n">threadsContainer</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">Thread:</span><span class="o">:</span><span class="n">isAlive</span><span class="o">)</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">thread</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"线程池创造的线程 : "</span> <span class="o">+</span> <span class="n">thread</span><span class="o">);</span>
                <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">mainThread</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>

        <span class="nc">ThreadGroup</span> <span class="n">mainThreadGroup</span> <span class="o">=</span> <span class="n">mainThread</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">mainThreadGroup</span><span class="o">.</span><span class="na">activeCount</span><span class="o">();</span>
        <span class="nc">Thread</span><span class="o">[]</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">[</span><span class="n">count</span><span class="o">];</span>
        <span class="n">mainThreadGroup</span><span class="o">.</span><span class="na">enumerate</span><span class="o">(</span><span class="n">threads</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">threads</span><span class="o">)</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">Thread:</span><span class="o">:</span><span class="n">isAlive</span><span class="o">)</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">thread</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"线程 : "</span> <span class="o">+</span> <span class="n">thread</span><span class="o">);</span>
                <span class="o">});</span>

        <span class="c1">// 关闭线程池</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setThreadFactory</span><span class="o">(</span><span class="nc">ExecutorService</span> <span class="n">executorService</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threadsContainer</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">executorService</span> <span class="k">instanceof</span> <span class="nc">ThreadPoolExecutor</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ThreadPoolExecutor</span> <span class="n">threadPoolExecutor</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ThreadPoolExecutor</span><span class="o">)</span> <span class="n">executorService</span><span class="o">;</span>
            <span class="nc">ThreadFactory</span> <span class="n">oldThreadFactory</span> <span class="o">=</span> <span class="n">threadPoolExecutor</span><span class="o">.</span><span class="na">getThreadFactory</span><span class="o">();</span>
            <span class="n">threadPoolExecutor</span><span class="o">.</span><span class="na">setThreadFactory</span><span class="o">(</span><span class="k">new</span> <span class="nc">DelegatingThreadFactory</span><span class="o">(</span><span class="n">oldThreadFactory</span><span class="o">,</span> <span class="n">threadsContainer</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DelegatingThreadFactory</span> <span class="kd">implements</span> <span class="nc">ThreadFactory</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ThreadFactory</span> <span class="n">delegate</span><span class="o">;</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threadsContainer</span><span class="o">;</span>

        <span class="kd">private</span> <span class="nf">DelegatingThreadFactory</span><span class="o">(</span><span class="nc">ThreadFactory</span> <span class="n">delegate</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threadsContainer</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">delegate</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">threadsContainer</span> <span class="o">=</span> <span class="n">threadsContainer</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">delegate</span><span class="o">.</span><span class="na">newThread</span><span class="o">(</span><span class="n">r</span><span class="o">);</span>
            <span class="c1">// cache thread</span>
            <span class="n">threadsContainer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">thread</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5future">5、FUTURE</h3>

<h4 id="基本版-17">基本版</h4>
<p>如何获取 Future 对象？</p>

<p>submit()</p>

<h4 id="进阶版-17">进阶版</h4>
<p>请举例 Future get() 以及 get(Long,TimeUnit) 方法的使用场景？</p>

<p><strong>超时等待</strong></p>

<p><strong>InterruptedException</strong></p>

<p><strong>ExcutionException</strong></p>

<p><strong>TimeOutException</strong></p>

<h4 id="劝退版-17">劝退版</h4>
<p>如何利用 Future 优雅地取消一个任务的执行？</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CancellableFutureQuestion</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>

        <span class="nc">Future</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// 3秒内执行完成，才算正常</span>
            <span class="n">action</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Thread 恢复中断状态</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">TimeoutException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 执行超时，适当地关闭</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span> <span class="c1">// 设置中断状态</span>
            <span class="n">future</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// 尝试取消</span>
        <span class="o">}</span>

        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">(</span><span class="kt">int</span> <span class="n">seconds</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">toMillis</span><span class="o">(</span><span class="n">seconds</span><span class="o">));</span> <span class="c1">// 5 - 3</span>
            <span class="c1">// seconds - timeout = 剩余执行时间</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// 判断并且清除中断状态</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">action</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"线程[%s] 正在执行...\n"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>  <span class="c1">// 2</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6volatile-变量">6、VOLATILE 变量</h3>

<h4 id="基本版-18">基本版</h4>
<p>在 Java 中，volatile 保证的是可见性还是原子性？</p>

<p><strong>volatile</strong> 既有可见性又有原子性（非我及彼），可见性是一定的，原子性是看情况的。对象类型和原生类型都是可见性，原生类型是原子性。</p>

<h4 id="进阶版-18">进阶版</h4>
<p>在 Java 中，volatile long 和 double 是线程安全的吗？</p>

<p>volatile long 和 double 是线程安全的。</p>

<h4 id="劝退版-18">劝退版</h4>
<p>在 Java 中，volatile 底层实现是基于什么机制？</p>

<p><strong>内存屏障</strong>（变量 Lock）机制：一个变量的原子性的保证。</p>

<h3 id="7原子操作-atomic">7、原子操作 ATOMIC</h3>

<h4 id="基本版-19">基本版</h4>
<p>为什么 AtomicBoolean 内部变量使用 int 实现，而非 boolean?</p>

<p>操作系统有 X86 和 X64，在虚拟机中，基于boolean 实现就是用 int 实现的，用哪一种实现都可以。虚拟机只有32位和64位的，所以用32位的实现。</p>

<h4 id="进阶版-19">进阶版</h4>
<p>在变量原子操作时，Atomic* CAS 操作比 synchronized 关键字哪个更重？</p>

<p><a href="https://wiki.openjdk.java.net/display/HotSpot/Synchronization">Synchronization</a></p>

<p>同线程的时候，synchronized 刚快；而多线程的时候则要分情况讨论。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AtomicQuestion</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">actualValue</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">AtomicInteger</span> <span class="n">atomicInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="c1">// if( value == 3 )</span>
        <span class="c1">//     value = 5</span>
        <span class="n">atomicInteger</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="c1">// 偏向锁 &lt; CAS 操作 &lt; 重锁（完全互斥）</span>
        <span class="c1">// CAS 操作也是相对重的操作，它也是实现 synchronized 瘦锁(thin lock)的关键</span>
        <span class="c1">// 偏向锁就是避免 CAS（Compare And Set/Swap)操作</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">expectedValue</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">actualValue</span> <span class="o">==</span> <span class="n">expectedValue</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">actualValue</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="劝退版-19">劝退版</h4>
<p>Atomic* CAS 的底层是如何实现？</p>

<p>汇编指令：<code class="highlighter-rouge">cpmxchg</code> (Compare and Exchange)</p>


                <hr style="visibility: hidden;">
            
     <!-- 打赏功能 -->
            <div>
                <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
                <div>☛小礼物走一走，来Github关注我☚</div>
                <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
                    <span>打 赏</span>
                </button>
                <div id="QR" style="display: none;">
                     
                <div id="wechat" style="display: inline-block">
                <img id="wechat_qr" src="/img/payimg/weipayimg.jpg" alt="caojiele 微信支付"/>
                <p>微信支付</p>
                </div>
                <div id="alipay" style="display: inline-block">
                <img id="alipay_qr" src="/img/payimg/alipayimg.jpg" alt="caojiele 支付宝"/>
                <p>支付宝</p>
                </div>                        
             </div>
         </div>         
     </div>
		    
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/zcblog/2019/04/10/docker/" data-toggle="tooltip" data-placement="top" title="简单聊会 Docker">
                        Previous<br>
                        <span>简单聊会 Docker</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/zcblog/2019/04/17/rpc-introduction/" data-toggle="tooltip" data-placement="top" title="浅谈 RPC">
                        Next<br>
                        <span>浅谈 RPC</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

<!--                  -->

<!--                  -->
		
		<!--   gitalk       -->
                
                <div class="comment">
                    <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
var gitalk = new Gitalk({
    id: '2019-04-14 00:00:00 +0800',
    clientID: '71d864566f502c0a73ba',
    clientSecret: '0275406b08f33cc8118d02eb9332cfb707f13bf0',
    repo: 'caojiele.github.io',
    owner: 'caojiele',
    admin: ['caojiele'], 
	labels: ['Gitalk'],
})
gitalk.render('gitalk-container')
</script> 

                </div>
                
             </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/zcblog/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=%E6%95%B0%E6%8D%AE%E5%BA%93"
                    title="数据库"
                    rel="2">数据库</a>
        
                <a data-sort="0015" 
                    href="/zcblog/archive/?tag=Java"
                    title="Java"
                    rel="11">Java</a>
        
                <a data-sort="0021" 
                    href="/zcblog/archive/?tag=%E6%85%95%E8%AF%BE%E7%BD%91%E6%89%8B%E8%AE%B0"
                    title="慕课网手记"
                    rel="5">慕课网手记</a>
        
                <a data-sort="0023" 
                    href="/zcblog/archive/?tag=%E9%9D%A2%E8%AF%95"
                    title="面试"
                    rel="3">面试</a>
        
                <a data-sort="0023" 
                    href="/zcblog/archive/?tag=Dubbo"
                    title="Dubbo"
                    rel="3">Dubbo</a>
        
                <a data-sort="0023" 
                    href="/zcblog/archive/?tag=RPC"
                    title="RPC"
                    rel="3">RPC</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=%E5%88%86%E5%B8%83%E5%BC%8F"
                    title="分布式"
                    rel="2">分布式</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=%E5%BE%AE%E6%9C%8D%E5%8A%A1"
                    title="微服务"
                    rel="2">微服务</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=%E7%94%9F%E6%B4%BB"
                    title="生活"
                    rel="2">生活</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=Nacos"
                    title="Nacos"
                    rel="2">Nacos</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=Spring"
                    title="Spring"
                    rel="2">Spring</a>
        
                <a data-sort="0024" 
                    href="/zcblog/archive/?tag=Spring+Cloud"
                    title="Spring Cloud"
                    rel="2">Spring Cloud
    </div>
</section>



                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://huangxuan.me/">黄玄的博客</a></li>
  
  <li><a href="http://www.xuxueli.com/blog/#/">许雪里的博客</a></li>
  
  <li><a href="https://mercyblitz.github.io/">小马哥的技术博客</a></li>
  
  <li><a href="http://ebnbin.com/">Ebn's Blog</a></li>
  
  <li><a href="http://blog.smdcn.net">SmdCn's Blog</a></li>
  
  <li><a href="https://www.ruoyaowu.com/">David's Game</a></li>
  
  <li><a href="http://dhong.co">DHong Say</a></li>
  
  <li><a href="https://yizibi.github.io">一之笔的博客</a></li>
  
</ul>


            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->


<!--  -->


 -->





    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  <li>
    <a href="/zcblog/feed.xml">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/wang-le-6-62">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/caojiele">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.linkedin.com/in/Jack-cao-387159129">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
</ul>


                <p class="copyright text-muted">
                本站总访问量:<span id="busuanzi_value_site_pv"></span>，本站访客数:<span id="busuanzi_value_site_uv"></span>，本文总阅读量:<span id="busuanzi_value_page_pv"></span>
                
			
                    <br>
		    <img src="/img/root/logo-record.png" style="margin-left"/>
			Copyright &copy; Jlcao Blog 2019  
                    <br>
			
		    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43021102000161" 
		    style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
			    湘公网安备 43021102000161号</a> |
		    
                    Powered by <a href="https://caojiele.com">Jlcao Blog</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
		  </div>
                </p>
            </div>
        </div>
    </div>
</footer>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- jQuery -->
<script src="/zcblog/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/zcblog/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/zcblog/js/hux-blog.min.js "></script>

<!-- script pointing to jekyll-search.js -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/zcblog/js/snackbar.js "></script>
<script src="/zcblog/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-120526213-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->


<!-- Search -->
 <script>
     function onKeyPress(e) {
         var keyCode = null;
         if(e.which)
             keyCode = e.which;
         else if(e.keyCode)
             keyCode = e.keyCode;
         if(keyCode == 13) {
             location.href="/search/?q=" + document.getElementById('search-input').value;
             return false;
         }
         return true;
     }
     var url_string = window.location.href;
    if (url_string.indexOf('search/?q') > 0){
        document.getElementById('search-ic').classList.toggle('hidden');
        var url = new URL(url_string);
        var question = url.searchParams.get("q");
        let title = document.getElementById('search-qs');
        title.innerHTML = '"' + question + '"';
        SimpleJekyllSearch({
            searchtext: question,
            resultsContainer: document.getElementById('results-container-list'),
            json: '/search.json',
            searchResultTemplate: '<li>\n' +
                '                <div class="cbp_tmlabel result">\n' +
                '                    <a href="{url}">\n' +
                '                        <h2 id="boxoffice">{title}</h2>\n' +
                '                        <ul>\n' +
                '                            <li>\n' +
                '                                {desc}' +
                '                            </li>\n' +
                '                        </ul>\n' +
                '                        <br>\n' +
                '                    </a>\n' +
                '                </div>\n' +
                '            </li>',
            noResultsText: '',
            fuzzy: false,
            limit: 10000
        });
    } else {
        SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('results-container'),
            json: '/search.json',
            searchResultTemplate: '<li><a href="{url}" style="display:block;width: 100%;padding-left:10px; padding-right:10px;"><i class="fa fa-angle-double-right fa-border" aria-hidden="true"></i>    {title}</a></li>',
            noResultsText: '',
            fuzzy: false
        });
    }
 </script>


<!-- Multi-Lingual -->


<!-- Back to the top -->
<a id="rocket" href="#top" class=""></a>
<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
<script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>



<!-- Image to hack wechat -->
<img src="/img/root/icon_wechat.png" width="0" height="0" />     
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
